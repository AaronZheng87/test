<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    <meta name="robots" content="none">
    <meta name="renderer" content="webkit">
    <script src="./core/jspsych.js"></script>
    <link rel="stylesheet" href="./core/jspsych.css">
    <style>
        html, body {
            background-color: grey;
        }
    </style>
</head>

<body></body>
<script type="text/javascript">
    let img = ["img/Cir.png", "img/FiveStar.png", "img/Pen.png", "img/Squ.png", "img/Tra.png", "img/Tri.png"];
    let word = ["三角形", "五角星", "五边形", "正方形", "梯形", "三角形"];

    let jspsych = new jsPsych({
        display_element: undefined,
        on_finish: () => {
            jspsych.data.displayData("json");

            let ID = jspsych.randomization.randomID();
            jspsych.github.upload(
                `${ID}.csv`,
                `${ID} is finished`,
                jspsych.data.get().csv()
            )
        },
        default_iti: 500,
        extensions: [],
        distance: 500,
        loadPath: "core",
        autoLoadAssets: true,
        allowRestart: true
    });
    jspsych.github = new GitHub({
        owner: "Chuan-Peng-Lab",
        repo: "SALT_Online",
        path: "/3_RawData/3_1_raw_data",
        token: ""
    });

    let timeline = [];
    timeline.push({
        type: "preload",
        images: img
    }, {
        type: "get-screen-size",
        prompt: "请放置卡片",
        starting_size: 500
    });

    timeline.push({
        timeline: [{
            type: "SALT",
            stimuli: [{
                obj_type: "cross",
                lineWidth: 5,
                color: "white",
                v_angle: 0.5,
                show_start_time: 500,
                show_end_time: 1100
            }, {
                obj_type: "image",
                v_angle: 1.2,
                content: jspsych.timelineVariable("img"),
                bias_angle: 1.2,
                show_start_time: 1000,
                show_end_time: 1100
            }, {
                obj_type: "text",
                v_angle: 1.2,
                content: jspsych.timelineVariable("word"),
                color: "white",
                bias_angle: 1.2,
                show_start_time: 1000,
                show_end_time: 1100
            }],
            distance: 500,
            screen: function () {
                return {
                    pixelW: jspsych.data.get().values()[1].screen_width_pixel,
                    pixelH: jspsych.data.get().values()[1].screen_height_pixel,
                    actualW: jspsych.data.get().values()[1].screen_width_physics,
                    actualH: jspsych.data.get().values()[1].screen_height_physics
                }
            },
            trial_duration: 2500,
            response_start_time: 1100,
            choices: ["n", "m"],
            on_finish: function(data) {
                data.condition = word.indexOf(data.stim_word) == img.indexOf(data.stim_img) ? "match" : "mismatch"
            }
        }],
        timeline_variables: jspsych.randomization.factorial({
            word: word,
            img: img
        })
    })

    jspsych.run(timeline);
</script>

</html>